(function(){var a,b,c,d,e,f,g,h,i,j;b={options:{cookieName:"ahoy",onArrival:null},matey:function(){var a,b,c;b=this.options.cookieName,a=this.options.onArrival,c=this.getSourceFromCookie(b);if(c==null||!!1){c=this.parseQuery(window.location.href),c!=null?c:c=this.parseReferrer(document.referrer),this.Cookie.set(b,this.JSON.stringify(c));if(this.Cookie.get(b)&&a!=null)return a(c)}},cookieName:function(a){return this.options.cookieName=a},onArrival:function(a){return this.options.onArrival=a},getSourceFromCookie:function(a){var b;if(b=this.Cookie.get(a))try{return this.JSON.parse(b)}catch(c){this.Cookie.unset(a)}return null},getHostsToCheck:function(a){var b,c;b=[a],c=a.split(".");while(c.shift())b.push(c.join("."));return b},parseQuery:function(a){var b,c;c=this.URI.parse(a);if(b=c.params.ahoy)try{return null}catch(d){}return null},parseReferrer:function(a){var b,c,d;b=a.length===0?this.matchHost(["(direct)"]):(d=this.URI.parse(a),c=this.getHostsToCheck(d.fullHost),this.matchHost(c,d)),b.referrer=a,b.arrived_at=(new Date).toString();return b},matchHost:function(a,b){var c,d,e,f,g;g=[];for(e=0,f=a.length;e<f;e++){d=a[e];if(c=this.hosts[d])return typeof c=="function"?c(b):c[0](c[1],c[2],c[3])(b)}return g}},h=typeof exports!="undefined"&&exports!==null?exports:this,h.ahoy=b,c=function(){return{name:"(direct)",category:"(direct)"}},j=function(a){return{name:a.host,category:"referral"}},i=function(a){return function(b){return{name:b.host,category:"search",extra:b.params[a]}}},g=function(a){return function(b){return{name:b.host,category:"paid search",extra:b.params[a]}}},a=function(a){return{name:a.host,category:"ad"}},f=function(a){return a.path==="/aclk"?g("q")(a):i("q")(a)},e=function(b){return b.path==="/ajax/emu/end.php"?a(b):j(b)},d=function(c){var d,e,f;f=c.params.url,d=b.URI.parse(f),e=a(d),e.extra="doubleclick";return e},b.hosts={"(direct)":c,"":j,"www.google.com":f,"facebook.com":e,"g.doubleclick.net":d,"www.daum.net":[i,"q"],"www.eniro.se":[i,"search_word"],"www.naver.com":[i,"query"],"www.yahoo.com":[i,"p"],"www.msn.com":[i,"q"],"www.bing.com":[i,"q"]},b.Cookie={get:function(a){var b;b=document.cookie.match(new RegExp(a+"=[^;]+($|;)","g"));return!b||!b[0]?null:unescape(b[0].substring(a.length+1,b[0].length).replace(";",""))||null},set:function(a,b,c,d,e,f){var g;g=[a+"="+escape(b)],d&&g.push("path="+d),e&&g.push("domain="+e),c&&g.push(this.hoursToExpireDate(c)),f&&g.push("secure");return document.cookie=g.join("; ")},unset:function(a){return this.set(a,"",-1)},hoursToExpireDate:function(a){var b;if(parseInt(a)==="NaN")return"";b=new Date,b.setTime(b.getTime()+parseInt(a)*60*60*1e3);return b.toGMTString()}},b.URI={parse:function(a){var b,c,d,e,f;e=this.options,d=e.strictMode?"strict":"loose",c=e.parser[d].exec(a),f={},b=14;while(b--)f[e.key[b]]=c[b]||"";f[e.q.name]={},f[e.key[12]].replace(e.q.parser,function(a,b,c){if(b)return f[e.q.name][b]=decodeURIComponent(c.replace("+","%20"))}),f.host=f.fullHost.substring(0,4)==="www."?f.fullHost.substring(4):f.fullHost;return f},options:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","fullHost","port","relative","path","directory","file","query","anchor"],q:{name:"params",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}},b.JSON={parse:function(a){var b,c,d,e;if(typeof a!="string")return null;a=a.trim();if(typeof window!="undefined"&&window!==null&&window.JSON!=null&&window.JSON.parse!=null)return window.JSON.parse(a);c=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,e=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,b=/(?:^|:|,)(?:\s*\[)+/g;if(c.test(a.replace(d,"@").replace(e,"]").replace(b,"")))return(new Function("return "+a))();throw"Invalid JSON: "+a},stringify:function(a){var b,c,d;if(typeof window!="undefined"&&window!==null&&window.JSON!=null&&window.JSON.stringify!=null)return window.JSON.stringify(a);c=function(){var c;c=[];for(b in a)d=a[b],d=typeof d=="string"?'"'+d.replace(/"/g,'\\"')+'"':"null",c.push('"'+b+'":'+d);return c}();return"{"+c.join(",")+"}"}}}).call(this)